<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>æ—¥æ–‡å‡åå¿«é€Ÿè¨“ç·´</title>
<style>
body{
    background:#121212;
    color:#e0e0e0;
    font-family:sans-serif;
    margin:0;
    padding:14px;
    touch-action: manipulation;
}
h1{text-align:center;color:#90caf9;font-size:22px;}
.controls{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:6px;
    margin-bottom:10px;
}
button,select{
    background:#1e1e1e;
    color:#e0e0e0;
    border:1px solid #333;
    border-radius:6px;
    padding:8px 12px;
    font-size:14px;
    cursor:pointer;
}
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
    gap:10px;
}
.card{
    background:#1e1e1e;
    border:1px solid #333;
    border-radius:10px;
    padding:12px;
    text-align:center;
}
.kana{font-size:26px;font-weight:bold;}
.roma{font-size:13px;color:#aaa;}
.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.7);
    display:none;
    align-items:center;
    justify-content:center;
}
.quizBox{
    background:#1e1e1e;
    border-radius:12px;
    padding:18px;
    width:90%;
    max-width:360px;
    text-align:center;
}
.question{font-size:24px;margin-bottom:8px;}
.quizControls{
    display:flex;
    justify-content:space-between;
    margin-bottom:8px;
}
.choices{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
}
.choice{
    background:#121212;
    border:1px solid #333;
    border-radius:8px;
    padding:12px;
    font-size:20px;
}
/* éŒ¯é¡Œæª¢è¦– */
.reviewOverlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.85);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
}
.reviewBox{
    background:#1e1e1e;
    width:90%;
    max-width:380px;
    max-height:80vh;
    overflow-y:auto;
    border-radius:12px;
    padding:16px;
}
.reviewItem{
    border-bottom:1px solid #333;
    padding:10px 0;
}
.reviewWrong{color:#ef5350;}
.reviewCorrect{color:#81c784;}
</style>
</head>

<body>

<h1>ğŸ‡¯ğŸ‡µ æ—¥æ–‡å‡åå¿«é€Ÿè¨“ç·´</h1>

<div class="controls">
<select id="level" onchange="loadData()">
  <option value="basic">äº”åéŸ³</option>
  <option value="daku">æ¿éŸ³</option>
  <option value="you">æ‹—éŸ³</option>
  <option value="all" selected>å…¨éƒ¨</option>
</select>

<button onclick="setOrder(false)">ğŸ“– æ­£åº</button>
<button onclick="setOrder(true)">ğŸ”€ éš¨æ©Ÿ</button>

<button onclick="startQuiz('visual','practice')">ğŸ‘€ çœ‹å­— (ç·´ç¿’)</button>
<button onclick="startQuiz('visual','exam')">ğŸ‘€ çœ‹å­— (è€ƒè©¦)</button>
<button onclick="startQuiz('listen','practice')">ğŸ§ è½åŠ› (ç·´ç¿’)</button>
<button onclick="startQuiz('listen','exam')">ğŸ§ è½åŠ› (è€ƒè©¦)</button>
<button onclick="startQuiz('roma','practice')">ğŸ”¤ ç¾…é¦¬æ‹¼éŸ³ (ç·´ç¿’)</button>
<button onclick="startQuiz('roma','exam')">ğŸ”¤ ç¾…é¦¬æ‹¼éŸ³ (è€ƒè©¦)</button>
</div>

<div class="grid" id="grid"></div>

<div class="modal" id="modal">
<div class="quizBox">
<div class="quizControls">
<button id="soundBtn" onclick="playSound()">ğŸ”Š æ’­æ”¾</button>
<button onclick="stopQuiz()">â›”</button>
</div>
<div class="question" id="question">ï¼Ÿ</div>
<div class="choices" id="choices"></div>
</div>
</div>

<script>
let pool=[],answer,quizType,quizMode;
let orderRandom=false,questionIndex=0,maxQuestions=20;
let examScore=0,wrongList=[],u;

const data={
basic:[["ã‚","a"],["ã„","i"],["ã†","u"],["ãˆ","e"],["ãŠ","o"],["ã‹","ka"],["ã","ki"],["ã","ku"],["ã‘","ke"],["ã“","ko"],["ã•","sa"],["ã—","shi"],["ã™","su"],["ã›","se"],["ã","so"],["ãŸ","ta"],["ã¡","chi"],["ã¤","tsu"],["ã¦","te"],["ã¨","to"],["ãª","na"],["ã«","ni"],["ã¬","nu"],["ã­","ne"],["ã®","no"],["ã¯","ha"],["ã²","hi"],["ãµ","fu"],["ã¸","he"],["ã»","ho"],["ã¾","ma"],["ã¿","mi"],["ã‚€","mu"],["ã‚","me"],["ã‚‚","mo"],["ã‚„","ya"],["ã‚†","yu"],["ã‚ˆ","yo"],["ã‚‰","ra"],["ã‚Š","ri"],["ã‚‹","ru"],["ã‚Œ","re"],["ã‚","ro"],["ã‚","wa"],["ã‚’","wo"],["ã‚“","n"]],
daku:[["ãŒ","ga"],["ã","gi"],["ã","gu"],["ã’","ge"],["ã”","go"],["ã–","za"],["ã˜","ji"],["ãš","zu"],["ãœ","ze"],["ã","zo"],["ã ","da"],["ã§","de"],["ã©","do"],["ã°","ba"],["ã³","bi"],["ã¶","bu"],["ã¹","be"],["ã¼","bo"],["ã±","pa"],["ã´","pi"],["ã·","pu"],["ãº","pe"],["ã½","po"]],
you:[["ãã‚ƒ","kya"],["ãã‚…","kyu"],["ãã‚‡","kyo"],["ã—ã‚ƒ","sha"],["ã—ã‚…","shu"],["ã—ã‚‡","sho"],["ã¡ã‚ƒ","cha"],["ã¡ã‚…","chu"],["ã¡ã‚‡","cho"],["ã«ã‚ƒ","nya"],["ã²ã‚ƒ","hya"],["ã¿ã‚ƒ","mya"],["ã‚Šã‚ƒ","rya"]]
};

const level=document.getElementById("level");
const grid=document.getElementById("grid");
const modal=document.getElementById("modal");
const question=document.getElementById("question");
const choices=document.getElementById("choices");
const soundBtn=document.getElementById("soundBtn");

function loadData(){
    const lv=level.value;
    pool = lv==="all" ? [...data.basic,...data.daku,...data.you] : [...data[lv]];
    if(orderRandom) pool.sort(()=>Math.random()-0.5);
    grid.innerHTML="";
    pool.forEach(k=>{
        const c=document.createElement("div");
        c.className="card";
        c.innerHTML=`<div class="kana">${k[0]}</div><div class="roma">${k[1]}</div>`;
        c.onclick=()=>speak(k[0]);
        grid.appendChild(c);
    });
}

function setOrder(r){orderRandom=r;loadData();}

function startQuiz(t,m){
    quizType = t;
    quizMode = m;
    questionIndex = examScore = 0;
    wrongList = [];
    modal.style.display = "flex";
    grid.style.display = "none";

    // è½åŠ›æ¨¡å¼æ‰é¡¯ç¤ºæ’­æ”¾æŒ‰éˆ•
    soundBtn.style.display = (quizType==="listen") ? "inline-block" : "none";

    nextQuestion();
}

function stopQuiz(){
    modal.style.display="none";
    grid.style.display="grid";
    if(quizMode==="exam"){
        alert(`è€ƒè©¦çµæŸï¼š${examScore}/${maxQuestions}`);
        if(wrongList.length) showReview();
    }
}

function nextQuestion(){
    if(quizMode==="exam" && questionIndex>=maxQuestions){stopQuiz();return;}
    answer = pool[Math.floor(Math.random()*pool.length)];
    questionIndex++;

    // é¡¯ç¤ºé¡Œç›®
    question.innerText = (quizType==="listen") ? "ğŸ”Š è½éŸ³é¸æ“‡" :
                         (quizType==="roma") ? answer[0] : answer[1];

    choices.innerHTML = "";

    const opts=[answer];
    while(opts.length<4){
        const r = pool[Math.floor(Math.random()*pool.length)];
        if(!opts.includes(r)) opts.push(r);
    }
    opts.sort(()=>Math.random()-0.5);

    opts.forEach(o=>{
        const b=document.createElement("div");
        b.className="choice";
        b.innerText = (quizType==="roma") ? o[1] : o[0];
        b.onclick = ()=>{
            if(o===answer) examScore++;
            else if(quizMode==="exam"){
                wrongList.push({
                    quizType,
                    question: quizType==="roma"?answer[0]:
                              quizType==="visual"?answer[1]:"ğŸ”Š è½éŸ³",
                    chosen: quizType==="roma"?o[1]:o[0],
                    correct: quizType==="roma"?answer[1]:answer[0]
                });
            }
            nextQuestion();
        };
        choices.appendChild(b);
    });
}

// é¡¯ç¤ºéŒ¯é¡Œ
function showReview(){
    const overlay=document.createElement("div");
    overlay.className="reviewOverlay";

    const box=document.createElement("div");
    box.className="reviewBox";
    box.innerHTML="<h3>âŒ éŒ¯èª¤é¡Œç›®</h3>";

    wrongList.forEach((w,i)=>{
        box.innerHTML+=`
        <div class="reviewItem">
            <strong>${i+1}. é¡Œç›®ï¼š</strong> ${w.question}<br>
            <span class="reviewWrong">ä½ é¸ï¼š${w.chosen}</span><br>
            <span class="reviewCorrect">æ­£ç¢ºï¼š${w.correct}</span>
        </div>`;
    });

    const btn=document.createElement("button");
    btn.innerText="é—œé–‰";
    btn.onclick=()=>overlay.remove();

    box.appendChild(btn);
    overlay.appendChild(box);
    document.body.appendChild(overlay);
}

// èªéŸ³æ’­æ”¾
function speak(t){
    if(u) speechSynthesis.cancel();
    u=new SpeechSynthesisUtterance(t);
    u.lang="ja-JP";
    speechSynthesis.speak(u);
}

function playSound(){speak(answer[0]);}

// é˜»æ“‹æ‰‹å‹¢ç¸®æ”¾
document.addEventListener("gesturestart",e=>e.preventDefault());
document.addEventListener("dblclick",e=>e.preventDefault());

loadData();
</script>

</body>
</html>
