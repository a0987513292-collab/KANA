<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>æ—¥æ–‡ç·´ç¿’</title>
<style>
body{
    background:#121212;
    color:#e0e0e0;
    font-family:sans-serif;
    margin:0;
    padding:14px;
    touch-action: manipulation;
}
h1{text-align:center;color:#90caf9;font-size:22px;}
.controls{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:6px;
    margin-bottom:10px;
}
button,select{
    background:#1e1e1e;
    color:#e0e0e0;
    border:1px solid #333;
    border-radius:6px;
    padding:8px 12px;
    font-size:14px;
    cursor:pointer;
}
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
    gap:10px;
}
.card{
    background:#1e1e1e;
    border:1px solid #333;
    border-radius:10px;
    padding:12px;
    text-align:center;
}
.kana{font-size:26px;font-weight:bold;}
.roma{font-size:13px;color:#aaa;}

.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.7);
    display:none;
    align-items:center;
    justify-content:center;
}
.quizBox{
    background:#1e1e1e;
    border-radius:12px;
    padding:18px;
    width:90%;
    max-width:360px;
    text-align:center;
}
.question{font-size:24px;margin-bottom:8px;}
.quizControls{
    display:flex;
    justify-content:flex-end;
    margin-bottom:8px;
}
.choices{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
}
.choice{
    background:#121212;
    border:1px solid #333;
    border-radius:8px;
    padding:12px;
    font-size:20px;
    transition: background 0.3s;
}

/* éŒ¯é¡Œæª¢è¦– */
.reviewOverlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.85);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
}
.reviewBox{
    background:#1e1e1e;
    width:90%;
    max-width:380px;
    max-height:80vh;
    overflow-y:auto;
    border-radius:12px;
    padding:16px;
}
.reviewItem{
    border-bottom:1px solid #333;
    padding:10px 0;
}
.reviewWrong{color:#ef5350;}
.reviewCorrect{color:#81c784;}
</style>
</head>

<body>

<h1>ğŸ‡¯ğŸ‡µ æ—¥æ–‡ç·´ç¿’</h1>

<div class="controls">
<select id="level" onchange="loadData()">
  <option value="basic">äº”åéŸ³</option>
  <option value="daku">æ¿éŸ³</option>
  <option value="you">æ‹—éŸ³</option>
  <option value="kanaAll">å…¨éƒ¨å‡å</option>
  <option value="all" selected>å–®å­—</option>
</select>

<button onclick="startQuiz('visual','practice')">ğŸ‘€ å–®å­— (ç·´ç¿’)</button>
<button onclick="startQuiz('visual','exam')">ğŸ‘€ å–®å­— (è€ƒè©¦)</button>
<button onclick="startQuiz('roma','practice')">ğŸ”¤ ç¾…é¦¬æ‹¼éŸ³ (ç·´ç¿’)</button>
<button onclick="startQuiz('roma','exam')">ğŸ”¤ ç¾…é¦¬æ‹¼éŸ³ (è€ƒè©¦)</button>
</div>

<div class="grid" id="grid"></div>

<div class="modal" id="modal">
<div class="quizBox">
<div class="quizControls">
<button onclick="stopQuiz()">â›”</button>
</div>
<div class="question" id="question">ï¼Ÿ</div>
<div class="choices" id="choices"></div>
</div>
</div>

<script>
let pool=[], answer, quizType, quizMode;
let orderRandom=false, questionIndex=0, maxQuestions=30;
let examScore=0, wrongList=[];
let quizPool=[];

const data={
  basic:[["ã‚","a"],["ã„","i"],["ã†","u"],["ãˆ","e"],["ãŠ","o"],["ã‹","ka"],["ã","ki"],["ã","ku"],["ã‘","ke"],["ã“","ko"],["ã•","sa"],["ã—","shi"],["ã™","su"],["ã›","se"],["ã","so"],["ãŸ","ta"],["ã¡","chi"],["ã¤","tsu"],["ã¦","te"],["ã¨","to"],["ãª","na"],["ã«","ni"],["ã¬","nu"],["ã­","ne"],["ã®","no"],["ã¯","ha"],["ã²","hi"],["ãµ","fu"],["ã¸","he"],["ã»","ho"],["ã¾","ma"],["ã¿","mi"],["ã‚€","mu"],["ã‚","me"],["ã‚‚","mo"],["ã‚„","ya"],["ã‚†","yu"],["ã‚ˆ","yo"],["ã‚‰","ra"],["ã‚Š","ri"],["ã‚‹","ru"],["ã‚Œ","re"],["ã‚","ro"],["ã‚","wa"],["ã‚’","wo"],["ã‚“","n"]],
  daku:[["ãŒ","ga"],["ã","gi"],["ã","gu"],["ã’","ge"],["ã”","go"],["ã–","za"],["ã˜","ji"],["ãš","zu"],["ãœ","ze"],["ã","zo"],["ã ","da"],["ã§","de"],["ã©","do"],["ã°","ba"],["ã³","bi"],["ã¶","bu"],["ã¹","be"],["ã¼","bo"],["ã±","pa"],["ã´","pi"],["ã·","pu"],["ãº","pe"],["ã½","po"]],
  you:[["ãã‚ƒ","kya"],["ãã‚…","kyu"],["ãã‚‡","kyo"],["ã—ã‚ƒ","sha"],["ã—ã‚…","shu"],["ã—ã‚‡","sho"],["ã¡ã‚ƒ","cha"],["ã¡ã‚…","chu"],["ã¡ã‚‡","cho"],["ã«ã‚ƒ","nya"],["ã²ã‚ƒ","hya"],["ã¿ã‚ƒ","mya"],["ã‚Šã‚ƒ","rya"]],
  words:[
    ["ã‚ã‚ŠãŒã¨ã†", "arigatou", "è¬è¬"],["ã“ã‚“ã«ã¡ã¯", "konnichiwa", "ä½ å¥½"],["ãŠã¯ã‚ˆã†", "ohayou", "æ—©å®‰"],["ã“ã‚“ã°ã‚“ã¯", "konbanwa", "æ™šä¸Šå¥½"],["ã‹ã‚ã„ã„", "kawaii", "å¯æ„›"],["ã™ã”ã„", "sugoi", "å²å®³"],["ã¤ã‚ˆã„", "tsuyoi", "å¼·å¤§"],["ã™ã", "suki", "å–œæ­¡"],["ã‚ã„", "ai", "æ„›"],["ã ã„ã™ã", "daisuki", "æœ€å–œæ­¡"],["ãŠã¤ã‹ã‚Œã•ã¾", "otsukaresama", "è¾›è‹¦äº†"],["ã‚ãã¶", "asobu", "ç©å—"],["ã„ã£ã—ã‚‡ã«ã‚ãã¶", "issho ni asobu", "ä¸€èµ·ç©å—"],["ã¨ã‚‚ã ã¡", "tomodachi", "æœ‹å‹"],["ãŒãã›ã„", "gakusei", "å­¸ç”Ÿ"],["ã›ã‚“ã›ã„", "sensei", "è€å¸«"],["ã¹ã‚“ãã‚‡ã†", "benkyou", "å­¸ç¿’"],["ã—ã‚…ãã ã„", "shukudai", "ä½œæ¥­"],["ãŒã£ã“ã†", "gakkou", "å­¸æ ¡"],["ã˜ã‹ã‚“", "jikan", "æ™‚é–“"],["ã„ããŒã—ã„", "isogashii", "å¿™ç¢Œ"],["ãŸã®ã—ã„", "tanoshii", "å¿«æ¨‚"],["ã‚€ãšã‹ã—ã„", "muzukashii", "å›°é›£"],["ã‹ã‚“ãŸã‚“", "kantan", "ç°¡å–®"],["ã—ã‚“ã›ã¤", "shinsetsu", "è¦ªåˆ‡"],["ã ã„ã˜", "daiji", "é‡è¦"],["ã‚†ã‚", "yume", "å¤¢æƒ³"],["ãã¼ã†", "kibou", "å¸Œæœ›"],["ã›ã„ã¡ã‚‡ã†", "seichou", "æˆé•·"],["ã—ã£ã±ã„", "shippai", "å¤±æ•—"],["ã›ã„ã“ã†", "seikou", "æˆåŠŸ"],["ã¡ã‹ã‚‰", "chikara", "åŠ›é‡"],["ã“ã“ã‚", "kokoro", "å¿ƒ"],["ã´ã‚“", "pin", "æ¨™è¨˜"],["ã“ã“", "koko", "é€™è£¡"],["ã¦ã", "teki", "æ•µäºº"],["ã™ã†ã«ã‚“", "suu-nin", "å¥½å¹¾å€‹äºº"],["ã²ã¨ã‚Š", "hitori", "ä¸€å€‹äºº"],["ã®ã“ã‚Š", "nokori", "å‰©ä¸‹"],["ã‚ã—ãŠã¨", "ashioto", "è…³æ­¥è²"],["ã¾ã‹ã›ã¦", "makasete", "äº¤çµ¦æˆ‘"],["ã”ã‚ã‚“", "gomen", "æŠ±æ­‰"],["ã‚ãƒ¼ã¾ãƒ¼", "aamaa", "è­·ç”²"],["ã‚ãƒ¼ã¾ãƒ¼ã‚ã‚Œ", "aamaa ware", "è­·ç”²ç ´äº†"],["ã°ã£ã¦ã‚Šãƒ¼", "batterii", "å¤§é›»æ± "],["ã›ã‚‹", "seru", "å°é›»æ± "],["ãã£ã¨", "kitto", "é†«ç™‚åŒ…"],["ã«ã", "niku", "å‰©è¡€ï¼ˆç„¡ç”²ï¼‰"],["ã ã†ã‚“", "daun", "å€’åœ°"],["ãŠã“ã™", "okosu", "æ‰¶èµ·éšŠå‹"],["ãŠã“ã—ã¦", "okoshite", "æ•‘æˆ‘"],["ãµãã„ã¨", "faito", "é–‹æ‰“"],["ã²ãã‚ˆ", "hikuyo", "è¦æ’¤äº†"],["ã‚ˆã›ã‚‹", "yoseru", "é éä¾†é›†åˆ"],["ã‹ãã‚Œã‚‹", "kakureru", "å…ˆèº²"],["ã¾ã", "maku", "ä¸ŸæŠ•æ“²ç‰©"],["ãã‚Œ", "gure", "æ‰‹æ¦´å½ˆ"],["ã†ã‚‹ã¨", "uruto", "å¤§æ‹›"],["ã†ã‚‹ã¨ãŸã¾ã£ãŸ", "uruto tamatta", "å¤§æ‹›å¥½äº†"],["ã™ãã‚ƒã‚“", "sukyan", "æƒæ"],["ã¯ã•ã‚€", "hasamu", "å¤¾æ“Š"],["ã‚ã‚“ã¡", "anchi", "å®‰å…¨å€"],["ã©ã“", "doko", "å“ªè£¡"],["ã©ã“ã«ã„ã‚‹", "doko ni iru", "åœ¨å“ªè£¡"],["ã©ã“ãƒ”ãƒ³", "doko pin", "ä½ æ¨™å“ª"],["ã©ã“è¦‹ã¦ã‚‹", "doko miteru", "åœ¨çœ‹å“ªå€‹æ–¹å‘"],["ã¦ã ã©ã“", "eki doko", "æ•µäººåœ¨å“ª"],["ã²ã ã‚Š", "hidari", "å·¦"],["ã¿ã", "migi", "å³"],["ã¦ã ã²ã ã‚Š", "teki hidari", "æ•µäººå·¦"],["ã¦ã ã¿ã", "teki migi", "æ•µäººå³"],["ã†ãˆ", "ue", "ä¸Šé¢"],["ã—ãŸ", "shita", "ä¸‹é¢"],["ãŸã‹ã„", "takai", "é«˜è™•"],["ã²ãã„", "hikui", "ä½è™•"],["ã†ãˆã„ã‚‹", "ue iru", "ä¸Šé¢æœ‰äºº"],["ã—ãŸã„ã‚‹", "shita iru", "ä¸‹é¢æœ‰äºº"],["ã“ã†ã—ã‚‡", "kousho", "é«˜é»"],["ã¦ã„ã—ã‚‡", "teisho", "ä½é»"],["ã²ã ã‚Š ã†ãˆ", "hidari ue", "å·¦ä¸Š"],["ã¿ã ã—ãŸ", "migi shita", "å³ä¸‹"],["ã“ã†ã—ã‚‡ã«ã¦ã", "kousho ni teki", "é«˜é»æœ‰æ•µäºº"],["ã—ãŸ ãµãŸã‚Š", "shita futari", "ä¸‹é¢å…©äºº"],["ã¿ãã®ã“ã†ã—ã‚‡", "migi no kousho", "å³é‚Šé«˜é»"],["ã˜ã‚…ã†", "juu", "æ§"],["ã—ã‚ã‚ãƒ¼ã¾ãƒ¼", "shiro aamaa", "ç™½ç”²"],["ã‚ãŠã‚ãƒ¼ã¾ãƒ¼", "ao aamaa", "è—ç”²"],["ã‚€ã‚‰ã•ãã‚ãƒ¼ã¾ãƒ¼", "murasaki aamaa", "ç´«ç”²"],["ãã‚“ã‚ãƒ¼ã¾ãƒ¼", "kin aamaa", "é‡‘ç”²"],["ã‚ã‹ã‚ãƒ¼ã¾ãƒ¼", "aka aamaa", "ç´…ç”²"]
  ]
};

function loadData(){
    const lv = level.value;
    if(lv === "all"){
        pool = [...data.words];
    } else if(lv === "kanaAll") {
        pool = [...data.basic, ...data.daku, ...data.you]; // åˆä½µä¸‰ç¨®å‡å
    } else {
        pool = [...data[lv]];
    }

    if(orderRandom) pool.sort(() => Math.random() - 0.5);

    grid.innerHTML = "";
    pool.forEach(k => {
        const c = document.createElement("div");
        c.className = "card";
        if(lv === "all"){
            c.innerHTML = `<p><strong>${k[0]}</strong><br>(${k[1]})<br>${k[2]||""}</p>`;
        } else {
            c.innerHTML = `<p><strong>${k[0]}</strong><br>${k[1]}</p>`;
        }
        grid.appendChild(c);
    });
}

function startQuiz(t, m) {
    quizType = t;
    quizMode = m;
    questionIndex = 0;
    examScore = 0;
    wrongList = [];
    quizPool = [...pool].sort(() => Math.random() - 0.5).slice(0, maxQuestions);
    modal.style.display = "flex";
    grid.style.display = "none";
    nextQuestion();
}

function stopQuiz() {
    modal.style.display = "none";
    grid.style.display = "grid";
    if (quizMode === "exam") {
        if (wrongList.length) showReview();
        alert(`è€ƒè©¦çµæŸï¼š${examScore}/${maxQuestions}`);
    }
}

function nextQuestion() {
    if (questionIndex >= quizPool.length) { stopQuiz(); return; }
    answer = quizPool[questionIndex];
    questionIndex++;

    question.innerHTML =
        quizType === "roma"
        ? `${answer[0]}<br><span style="font-size:14px;color:#aaa;">ï¼ˆ${answer[2]||""}ï¼‰</span>`
        : `${answer[1]}<br><span style="font-size:14px;color:#aaa;">ï¼ˆ${answer[2]||""}ï¼‰</span>`;

    const box = choices;
    box.innerHTML = "";

    const opts = [answer];
    while (opts.length < 4) {
        const r = pool[Math.floor(Math.random() * pool.length)];
        if (!opts.includes(r)) opts.push(r);
    }
    opts.sort(() => Math.random() - 0.5);

    opts.forEach(o => {
        const b = document.createElement("div");
        b.className = "choice";
        b.innerText = quizType === "roma" ? o[1] : o[0];
        b.onclick = () => {
            if (quizMode === "practice") {
                if (o === answer) {
                    b.style.backgroundColor = "#81c784"; 
                } else {
                    b.style.backgroundColor = "#ef5350";
                    Array.from(box.children).forEach(c => {
                        if (c.innerText === (quizType === "roma" ? answer[1] : answer[0])) {
                            c.style.backgroundColor = "#81c784";
                        }
                    });
                }
                setTimeout(nextQuestion, 800);
            } else if (quizMode === "exam") {
                if (o !== answer) wrongList.push({
                    kana: answer[0],
                    roma: answer[1],
                    mean: answer[2]||"",  
                    chosenText: quizType === "roma" ? o[1] : o[0],
                    chosenMean: o[2]||"",
                    mode: quizType
                });
                if (o === answer) examScore++;
                nextQuestion();
            }
        };
        box.appendChild(b);
    });
}

function showReview() {
    const overlay = document.createElement("div");
    overlay.className = "reviewOverlay";
    const box = document.createElement("div");
    box.className = "reviewBox";
    box.innerHTML = "<h3>âŒ éŒ¯èª¤é¡Œç›®</h3>";

    wrongList.forEach((w, i) => {
        const questionDisplay = w.mode === "roma" ? `${w.kana}ï¼ˆ${w.mean}ï¼‰` : `${w.roma}ï¼ˆ${w.mean}ï¼‰`;
        const chosenDisplay = `${w.chosenText}ï¼ˆ${w.chosenMean}ï¼‰`;
        const answerDisplay = w.mode === "roma" ? `${w.roma}ï¼ˆ${w.mean}ï¼‰` : `${w.kana}ï¼ˆ${w.mean}ï¼‰`;
        box.innerHTML += `
        <div class="reviewItem">
            ${i + 1}. ${questionDisplay}<br>
            <span class="reviewWrong">ä½ é¸ï¼š${chosenDisplay}</span><br>
            <span class="reviewCorrect">æ­£ç¢ºï¼š${answerDisplay}</span>
        </div>`;
    });

    const btn = document.createElement("button");
    btn.innerText = "é—œé–‰";
    btn.onclick = () => overlay.remove();
    box.appendChild(btn);
    overlay.appendChild(box);
    document.body.appendChild(overlay);
}

loadData();
</script>

</body>
</html>
