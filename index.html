<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>æ—¥æ–‡ç·´ç¿’</title>
<style>
body{
    background:#121212;
    color:#e0e0e0;
    font-family:sans-serif;
    margin:0;
    padding:14px;
    touch-action: manipulation;
}
h1{text-align:center;color:#90caf9;font-size:22px;}
.controls{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:6px;
    margin-bottom:10px;
}
button,select{
    background:#1e1e1e;
    color:#e0e0e0;
    border:1px solid #333;
    border-radius:6px;
    padding:8px 12px;
    font-size:14px;
    cursor:pointer;
}
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
    gap:10px;
}
.card{
    background:#1e1e1e;
    border:1px solid #333;
    border-radius:10px;
    padding:12px;
    text-align:center;
}
.kana{font-size:26px;font-weight:bold;}
.roma{font-size:13px;color:#aaa;}

.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.7);
    display:none;
    align-items:center;
    justify-content:center;
}
.quizBox{
    background:#1e1e1e;
    border-radius:12px;
    padding:18px;
    width:90%;
    max-width:360px;
    text-align:center;
}
.question{font-size:24px;margin-bottom:8px;}
.quizControls{
    display:flex;
    justify-content:flex-end;
    margin-bottom:8px;
}
.choices{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
}
.choice{
    background:#121212;
    border:1px solid #333;
    border-radius:8px;
    padding:12px;
    font-size:20px;
    transition: background 0.3s;
}

/* éŒ¯é¡Œæª¢è¦– */
.reviewOverlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.85);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
}
.reviewBox{
    background:#1e1e1e;
    width:90%;
    max-width:380px;
    max-height:80vh;
    overflow-y:auto;
    border-radius:12px;
    padding:16px;
}
.reviewItem{
    border-bottom:1px solid #333;
    padding:12px 0;
}
.reviewWrong{color:#ef5350;}
.reviewCorrect{color:#81c784;}
.roma-word{
    font-size:12px;
    color:#aaa;
}
</style>
</head>

<body>

<h1>ğŸ‡¯ğŸ‡µ æ—¥æ–‡ç·´ç¿’</h1>

<div class="controls">
<select id="level" onchange="loadData()">
  <option value="basic">5ï¸âƒ£0ï¸âƒ£äº”åéŸ³</option>
  <option value="daku">2ï¸âƒ£5ï¸âƒ£æ¿éŸ³/åŠæ¿éŸ³</option>
  <option value="you">3ï¸âƒ£6ï¸âƒ£æ‹—éŸ³</option>
  <option value="kanaAll">1ï¸âƒ£0ï¸âƒ£7ï¸âƒ£å…¨éƒ¨å‡å</option>
  <option value="basicResponse">ğŸ—£ï¸ åŸºæœ¬å›æ‡‰ï¼æºé€š</option>
  <option value="position">ğŸ“ æŒ‡ç¤ºï¼ä½ç½®</option>
  <option value="actions">ğŸƒ å‹•ä½œï¼æ—¥å¸¸å‹•è©</option>
  <option value="family">ğŸ‘ª å®¶äºº</option>
  <option value="fps">ğŸ® FPS</option>
  <option value="emotion">ğŸ§  æƒ…ç·’ï¼åæ‡‰</option>
  <option value="allCombined">ğŸ“š å…¨éƒ¨é¡Œåº«</option>
</select>

<button onclick="startQuiz('visual','practice')">ğŸ‘€ å–®å­— (ç·´ç¿’)</button>
<button onclick="startQuiz('visual','exam')">ğŸ‘€ å–®å­— (è€ƒè©¦)</button>
<button onclick="startQuiz('roma','practice')">ğŸ”¤ ç¾…é¦¬æ‹¼éŸ³ (ç·´ç¿’)</button>
<button onclick="startQuiz('roma','exam')">ğŸ”¤ ç¾…é¦¬æ‹¼éŸ³ (è€ƒè©¦)</button>
</div>

<div class="grid" id="grid"></div>

<div class="modal" id="modal">
<div class="quizBox">
<div class="quizControls">
<button onclick="stopQuiz()">â›”</button>
</div>
<div class="question" id="question">ï¼Ÿ</div>
<div class="choices" id="choices"></div>
</div>
</div>

<script>
let pool=[], answer, quizType, quizMode;
let orderRandom=false, questionIndex=0, maxQuestions=30;
let examScore=0, wrongList=[]; 
let quizPool=[];
let answerList = [];

const data={
basic:[["ã‚","a"],["ã„","i"],["ã†","u"],["ãˆ","e"],["ãŠ","o"],["ã‹","ka"],["ã","ki"],["ã","ku"],["ã‘","ke"],["ã“","ko"],["ã•","sa"],["ã—","shi"],["ã™","su"],["ã›","se"],["ã","so"],["ãŸ","ta"],["ã¡","chi"],["ã¤","tsu"],["ã¦","te"],["ã¨","to"],["ãª","na"],["ã«","ni"],["ã¬","nu"],["ã­","ne"],["ã®","no"],["ã¯","ha"],["ã²","hi"],["ãµ","fu"],["ã¸","he"],["ã»","ho"],["ã¾","ma"],["ã¿","mi"],["ã‚€","mu"],["ã‚","me"],["ã‚‚","mo"],["ã‚„","ya"],["ã‚†","yu"],["ã‚ˆ","yo"],["ã‚‰","ra"],["ã‚Š","ri"],["ã‚‹","ru"],["ã‚Œ","re"],["ã‚","ro"],["ã‚","wa"],["ã‚’","wo"],["ã‚“","n"]],
daku: [
  ["ãŒ","ga"], ["ã","gi"], ["ã","gu"], ["ã’","ge"], ["ã”","go"],
  ["ã–","za"], ["ã˜","ji(1)"], ["ãš","zu(1)"], ["ãœ","ze"], ["ã","zo"],
  ["ã ","da"], ["ã¢","ji(2)"], ["ã¥","zu(2)"], ["ã§","de"], ["ã©","do"],
  ["ã°","ba"], ["ã³","bi"], ["ã¶","bu"], ["ã¹","be"], ["ã¼","bo"],
  ["ã±","pa"], ["ã´","pi"], ["ã·","pu"], ["ãº","pe"], ["ã½","po"]],
you: [["ãã‚ƒ","kya"], ["ãã‚…","kyu"], ["ãã‚‡","kyo"], ["ãã‚ƒ","gya"], ["ãã‚…","gyu"], ["ãã‚‡","gyo"], ["ã—ã‚ƒ","sha"], ["ã—ã‚…","shu"], ["ã—ã‚‡","sho"], ["ã˜ã‚ƒ","ja"], ["ã˜ã‚…","ju"], ["ã˜ã‚‡","jo"], ["ã¡ã‚ƒ","cha"], ["ã¡ã‚…","chu"], ["ã¡ã‚‡","cho"], ["ã«ã‚ƒ","nya"], ["ã«ã‚…","nyu"], ["ã«ã‚‡","nyo"], ["ã²ã‚ƒ","hya"], ["ã²ã‚…","hyu"], ["ã²ã‚‡","hyo"], ["ã³ã‚ƒ","bya"], ["ã³ã‚…","byu"], ["ã³ã‚‡","byo"], ["ã´ã‚ƒ","pya"], ["ã´ã‚…","pyu"], ["ã´ã‚‡","pyo"], ["ã¿ã‚ƒ","mya"], ["ã¿ã‚…","myu"], ["ã¿ã‚‡","myo"], ["ã‚Šã‚ƒ","rya"], ["ã‚Šã‚…","ryu"], ["ã‚Šã‚‡","ryo"],["ã‚”ã‚ƒ","vya"], ["ã‚”ã‚…","vyu"], ["ã‚”ã‚‡","vyo"]],
basicResponse:[["ã¯ã„","hai","æ˜¯"],["ã„ã„ãˆ","iie","ä¸æ˜¯"],["ã‚ã‚ŠãŒã¨ã†","arigatou","è¬è¬"],["ã“ã‚“ã«ã¡ã¯","konnichiwa","ä½ å¥½"],["ãŠã¯ã‚ˆã†","ohayou","æ—©å®‰"],["ã“ã‚“ã°ã‚“ã¯","konbanwa","æ™šä¸Šå¥½"],["ãŠã¤ã‹ã‚Œã•ã¾","otsukaresama","è¾›è‹¦äº†"],["ã”ã‚ã‚“","gomen","æŠ±æ­‰"],["ã”ã‚ã‚“ãªã•ã„","gomennasai","å°ä¸èµ·"],["ã™ã¿ã¾ã›ã‚“","sumimasen","ä¸å¥½æ„æ€ï¼å°ä¸èµ·"],["ãŠé¡˜ã„ã—ã¾ã™","onegaishimasu","æ‹œè¨—äº†"],["ã©ã†ã","douzo","è«‹"],["ã©ã†ã„ãŸã—ã¾ã—ã¦","douitashimashite","ä¸å®¢æ°£"],["ã„ã„","ii","å¥½ï¼å¯ä»¥"],["ã„ã„ã‚ˆ","ii yo","å¯ä»¥"],["ã ã‚","dame","ä¸è¡Œ"],["ã ã‚ã ","dame da","ä¸è¡Œ"],["ãŠã‘","oke","OK"],["ã‚ã‹ã£ãŸ","wakatta","çŸ¥é“äº†"],["ã‚ã‹ã‚Šã¾ã—ãŸ","wakarimashita","æˆ‘çŸ¥é“äº†"],["ã‚ã‹ã‚‰ãªã„","wakaranai","ä¸çŸ¥é“"],["ã—ã‚‰ãªã„","shiranai","ä¸çŸ¥é“"],["ã ã„ã˜ã‚‡ã†ã¶","daijoubu","æ²’äº‹ï¼æ²’å•é¡Œ"],["ã¨ã‚‚ã ã¡","tomodachi","æœ‹å‹"],["ãŒãã›ã„","gakusei","å­¸ç”Ÿ"],["ã›ã‚“ã›ã„","sensei","è€å¸«"],["ã—ã‚…ãã ã„","shukudai","ä½œæ¥­"],["ãŒã£ã“ã†","gakkou","å­¸æ ¡"],["ã˜ã‹ã‚“","jikan","æ™‚é–“"]],
position:[["ã“ã“","koko","é€™è£¡"],["ãã“","soko","é‚£è£¡"],["ã‚ãã“","asoko","é‚£é‚Š"],["ã©ã“","doko","å“ªè£¡"],["ã“ã‚Œ","kore","é€™å€‹"],["ãã‚Œ","sore","é‚£å€‹"],["ã†ãˆ","ue","ä¸Šé¢"],["ã—ãŸ","shita","ä¸‹é¢"],["ãªã‹","naka","è£¡é¢"],["ãã¨","soto","å¤–é¢"],["ã²ã ã‚Š","hidari","å·¦"],["ã¿ã","migi","å³"],["ã¾ãˆ","mae","å‰"],["ã†ã—ã‚","ushiro","å¾Œé¢"]],
actions:[["ã„ã","iku","å»"],["ãã‚‹","kuru","ä¾†"],["ã‹ãˆã‚‹","kaeru","å›å»"],["ã¯ã„ã‚‹","hairu","é€²å»"],["ã§ã‚‹","deru","å‡ºå»"],["ã¾ã£ã¦","matte","ç­‰ç­‰"],["ã¡ã‚‡ã£ã¨ã¾ã£ã¦","chotto matte","ç­‰ä¸€ä¸‹"],["ã¿ã‚‹","miru","çœ‹"],["ãã","kiku","è½ï¼å•"],["ã¯ãªã™","hanasu","èªªè©±"],["ã™ã‚‹","suru","åš"],["ã¤ã‹ã†","tsukau","ç”¨"],["ã‹ã†","kau","è²·"],["ã‚ãã¶","asobu","ç©"],["ã„ã£ã—ã‚‡ã«ã‚ãã¶","issho ni asobu","ä¸€èµ·ç©"],["ã¹ã‚“ãã‚‡ã†","benkyou","å­¸ç¿’"]],
family:[["ã¡ã¡","chichi","çˆ¶ï¼çˆ¸çˆ¸"],["ãŠã¨ã†ã•ã‚“","otousan","çˆ¸çˆ¸"],["ãƒ‘ãƒ‘","papa","çˆ¸çˆ¸ï¼ˆå°å­©ï¼è¦ªæš±ï¼‰"],["ãŠã‚„ã˜","oyaji","çˆ¸çˆ¸ï¼ˆå£èªï¼‰"],["ã¯ã¯","haha","æ¯ï¼åª½åª½"],["ãŠã‹ã‚ã•ã‚“","okaasan","åª½åª½"],["ãƒãƒ","mama","åª½åª½ï¼ˆå°å­©ï¼è¦ªæš±ï¼‰"],["ãŠãµãã‚","ofukuro","åª½åª½ï¼ˆå£èªï¼‰"],["ã‚ã«","ani","å“¥å“¥"],["ãŠã«ã„ã•ã‚“","oniisan","å“¥å“¥ï¼ˆæ•¬ç¨±ï¼‰"],["ãŠã«ã„ã¡ã‚ƒã‚“","oniichan","å“¥å“¥ï¼ˆè¦ªæš±ï¼‰"],["ã‚ã­","ane","å§å§"],["ãŠã­ãˆã•ã‚“","oneesan","å§å§ï¼ˆæ•¬ç¨±ï¼‰"],["ãŠã­ãˆã¡ã‚ƒã‚“","oneechan","å§å§ï¼ˆè¦ªæš±ï¼‰"],["ãŠã¨ã†ã¨","otouto","å¼Ÿå¼Ÿ"],["ã„ã‚‚ã†ã¨","imouto","å¦¹å¦¹"],["ãã‚‡ã†ã ã„","kyoudai","å…„å¼Ÿå§Šå¦¹ï¼ˆçµ±ç¨±ï¼‰"],["ã—ã¾ã„","shimai","å§Šå¦¹"],["ãã‚‡ã†ã ã„ã—ã¾ã„","kyoudai shimai","å…„å¼Ÿå§Šå¦¹"],["ããµ","sofu","ç¥–çˆ¶"],["ã˜ã„ã¡ã‚ƒã‚“","jiichan","çˆºçˆºï¼ˆè¦ªæš±ï¼‰"],["ãŠã˜ã„ã¡ã‚ƒã‚“","ojiichan","çˆºçˆºï¼ˆè¦ªæš±ï¼‰"],["ãã¼","sobo","ç¥–æ¯"],["ã°ã‚ã¡ã‚ƒã‚“","baachan","å¥¶å¥¶ï¼ˆè¦ªæš±ï¼‰"],["ãŠã°ã‚ã¡ã‚ƒã‚“","obaachan","å¥¶å¥¶ï¼ˆè¦ªæš±ï¼‰"],["ã‚€ã™ã“","musuko","å…’å­"],["ã‚€ã™ã‚","musume","å¥³å…’"],["ã“ã©ã‚‚","kodomo","å­©å­"],["ã¾ã”","mago","å­«å­ï¼å­«å¥³"],["ã¤ã¾","tsuma","å¦»å­ï¼ˆè‡ªå·±èªªï¼‰"],["ã‚ˆã‚","yome","è€å©†ï¼åª³å©¦"],["ãŠã£ã¨","otto","ä¸ˆå¤«"],["ã ã‚“ãª","danna","è€å…¬"],["ã¯ã„ãã†ã—ã‚ƒ","haiguusha","é…å¶"],["ã‚Šã‚‡ã†ã—ã‚“","ryoushin","çˆ¶æ¯"],["ãŠã‚„","oya","çˆ¶æ¯ï¼å®¶é•·"],["ãŠã‚„ã“","oyako","è¦ªå­"],["ãŠã˜","oji","å”å”ï¼ä¼¯ä¼¯"],["ãŠã°","oba","é˜¿å§¨ï¼ä¼¯æ¯"],["ãŠã„","oi","å§ªå­ï¼å¤–ç”¥"],["ã‚ã„","mei","å§ªå¥³ï¼å¤–ç”¥å¥³"],["ã„ã¨ã“","itoko","å ‚ï¼è¡¨å…„å¼Ÿå§Šå¦¹"],["ã—ã‚“ã›ã","shinseki","è¦ªæˆš"],["ãã‚Šã®ã¡ã¡","giri no chichi","å²³çˆ¶ï¼å…¬å…¬"],["ãã‚Šã®ã¯ã¯","giri no haha","å²³æ¯ï¼å©†å©†"],["ã‹ãã","kazoku","å®¶äººï¼å®¶åº­"],["ã‹ããã„ã‚“","kazokuin","å®¶åº­æˆå“¡"],["ã„ã£ã‹","ikka","ä¸€å®¶äºº"],["ã‹ã¦ã„","katei","å®¶åº­"],["ã†ã¡","uchi","æˆ‘å®¶ï¼å®¶è£¡"],["ã˜ãŸã","jitaku","è‡ªå·±å®¶"],["ã†ã¡ã®","uchi no","æˆ‘å®¶çš„ï½"],["ã‹ããã¿ã‚“ãª","kazoku minna","å…¨å®¶äºº"],["ã‹ãããã‚‹ã¿","kazokugurumi","å…¨å®¶ä¸€èµ·"]],
fps:[["ã¦ã","teki","æ•µäºº"],["ã¦ãã„ã‚‹","teki iru","æœ‰æ•µäºº"],["ã“ã“ã¦ã","koko teki","é€™è£¡æœ‰æ•µ"],["ã²ã¨ã‚Š","hitori","ä¸€å€‹äºº"],["ãµãŸã‚Š","futari","å…©å€‹äºº"],["ã™ã†ã«ã‚“","suu-nin","å¥½å¹¾å€‹äºº"],["ã„ã‚‹","iru","æœ‰äºº"],["ã„ãªã„","inai","æ²’äºº"],["ã˜ã‚…ã†","juu","æ§"],["ã¶ã","buki","æ­¦å™¨"],["ã ã‚“","dan","å­å½ˆ"],["ã ã‚“ãªã„","dan nai","æ²’å­å½ˆ"],["ã˜ã‚…ã†ãªã„","juu nai","æ²’æ§"],["ãˆã„ã‚€","eimu","ç„æº–"],["ã‚Šã‚ãƒ¼ã©","riroodo","æ›å½ˆ"],["ã—ã‚ƒã’ã","shageki","å°„æ“Š"],["ã‹ã°ãƒ¼","kabaa","æ©è­·"],["ã‚‰ã£ã—ã‚…","rasshu","è¡é‹’"],["ã²ãã‚ˆ","hiku yo","è¦æ’¤äº†"],["ãµãã„ã¨","faito","é–‹æ‰“"],["ãŠã¨ã™","otosu","æ“Šå€’"],["ã®ã£ã","nokku","æ“Šå€’ï¼ˆæœªæ­»ï¼‰"],["ã ã†ã‚“","daun","å€’åœ°"],["ãŠã“ã™","okosu","æ•‘äºº"],["ãŠã“ã—ã¦","okoshite","æ•‘æˆ‘"],["ã‚ã‚“ã¡","anchi","å®‰å…¨å€"],["ã‚ã‚“ã¡ã¯ã„ã£ãŸ","anchi haitta","é€²å…¥å®‰å…¨å€"],["ã‚ã‚“ã¡ãã¨","anchi soto","åœ¨åœˆå¤–"],["ã¤ãã‚ã‚“ã¡","tsugi anchi","ä¸‹ä¸€å€‹å®‰å…¨å€"],["ã‚ãƒ¼ã¾ãƒ¼","aamaa","è­·ç”²"],["ã‚ãƒ¼ã¾ãƒ¼ã‚ã‚Œ","aamaa ware","è­·ç”²ç ´äº†"],["ã—ã‚ã‚ãƒ¼ã¾ãƒ¼","shiro aamaa","ç™½ç”²"],["ã‚ãŠã‚ãƒ¼ã¾ãƒ¼","ao aamaa","è—ç”²"],["ã‚€ã‚‰ã•ãã‚ãƒ¼ã¾ãƒ¼","murasaki aamaa","ç´«ç”²"],["ãã‚“ã‚ãƒ¼ã¾ãƒ¼","kin aamaa","é‡‘ç”²"],["ã‚ã‹ã‚ãƒ¼ã¾ãƒ¼","aka aamaa","ç´…ç”²"],["ã°ã£ã¦ã‚Šãƒ¼","batterii","é›»æ± "],["ã°ã£ãã±ã£ã","bakkupakku","èƒŒåŒ…"],["ã‘ã‚“ã•ã¤","kensatsu","æª¢æŸ¥"],["ããªãˆ","sona","è£œçµ¦"],["ã´ã‚“","pin","æ¨™è¨˜"]],
emotion:[["ã¾ã˜","maji","çœŸçš„å‡çš„"],["ã‚„ã°ã„","yabai","ç³Ÿäº†ï¼å¾ˆçŒ›"],["ã™ã”ã„","sugoi","å²å®³"],["ã‚€ãšã„","muzui","å¥½é›£"],["ãã¤ã„","kitsui","å¾ˆç¡¬ï¼é›£æ‰“"],["ã„ãŸã„","itai","å¥½ç—›"],["ã¤ã‚‰ã„","tsurai","é›£å—"],["ã ã‚‹ã„","darui","å¥½ç´¯ï¼ç…©"],["ãªã‚‹ã»ã©","naruhodo","åŸä¾†å¦‚æ­¤"],["ãŸã—ã‹ã«","tashikani","ç¢ºå¯¦"],["ã¾ã‚ã„ã„","maa ii","ç®—äº†"],["ã“ã‚ã„","kowai","å¯æ€•"],["ã†ã‚Œã—ã„","ureshii","é–‹å¿ƒ"],["ã‹ãªã—ã„","kanashii","é›£é"],["ã„ã‚‰ã„ã‚‰","iraira","ç…©èº"],["ã¯ã‚‰ãŒãŸã¤","haragata tsu","ç”Ÿæ°£"],["ã‹ã‚ã„ã„","kawaii","å¯æ„›"],["ã¤ã‚ˆã„","tsuyoi","å¼·å¤§"],["ã™ã","suki","å–œæ­¡"],["ã ã„ã™ã","daisuki","æœ€å–œæ­¡"],["ã‚ã„","ai","æ„›"],["ã„ããŒã—ã„","isogashii","å¿™ç¢Œ"],["ãŸã®ã—ã„","tanoshii","å¿«æ¨‚"],["ã‚€ãšã‹ã—ã„","muzukashii","å›°é›£"],["ã‹ã‚“ãŸã‚“","kantan","ç°¡å–®"],["ã—ã‚“ã›ã¤","shinsetsu","è¦ªåˆ‡"],["ã ã„ã˜","daiji","é‡è¦"],["ã‚†ã‚","yume","å¤¢æƒ³"],["ãã¼ã†","kibou","å¸Œæœ›"],["ã›ã„ã¡ã‚‡ã†","seichou","æˆé•·"],["ã—ã£ã±ã„","shippai","å¤±æ•—"],["ã›ã„ã“ã†","seikou","æˆåŠŸ"],["ã¡ã‹ã‚‰","chikara","åŠ›é‡"],["ã“ã“ã‚","kokoro","å¿ƒ"]]
};

function loadData(){
    const lv = level.value;

    if(lv === "allCombined"){
        // åˆä½µæ‰€æœ‰åˆ†é¡å–®å­—ï¼ˆä¿æŒæ¯è¡Œè³‡æ–™ç¨ç«‹ï¼‰
        pool = [
          ...data.basic,
          ...data.daku,
          ...data.you,
          ...data.basicResponse,
          ...data.position,
          ...data.actions,
          ...data.family,
          ...data.fps,
          ...data.emotion
        ];
    } else if(lv === "all"){
        pool = [...data.words];
    } else if(lv === "kanaAll") {
        pool = [...data.basic, ...data.daku, ...data.you];
    } else {
        pool = [...data[lv]];
    }

    if(orderRandom) pool.sort(() => Math.random() - 0.5);

grid.innerHTML = "";
pool.forEach(k => {
    const c = document.createElement("div");
    c.className = "card";

    if(
        lv === "basicResponse" ||
        lv === "position" ||
        lv === "actions" ||
        lv === "family" ||
        lv === "fps" ||
        lv === "emotion" ||
        lv === "allCombined"
    ){
        c.innerHTML = `
          <p>
            <strong>${k[0]}</strong><br>
            <span class="roma-word">(${k[1]})</span><br>
            ${k[2] || ""}
          </p>
        `;
    } else {
        c.innerHTML = `<p><strong>${k[0]}</strong><br>${k[1]}</p>`;
    }

    grid.appendChild(c);
});
}

function startQuiz(t, m) {
    quizType = t;
    quizMode = m;
    questionIndex = 0;
    examScore = 0;
    wrongList = [];
    answerList = [];

    let availableQuestions = pool.length;

if (quizMode === "exam") {
    // é¡Œç›®æ•¸ = å–®å­—ç¸½æ•¸ + 0ï¼ˆä¹Ÿå°±æ˜¯å…¨éƒ¨é¡Œåº«ï¼‰
    const numQuestions = availableQuestions; // åŸæœ¬æ¸›1çš„åœ°æ–¹å»æ‰
    quizPool = [...pool].sort(() => Math.random() - 0.5).slice(0, numQuestions);
}
 else {
        // ç·´ç¿’æ¨¡å¼ï¼šæ•´å€‹é¡Œåº«ã€éš¨æ©Ÿ
        quizPool = [...pool].sort(() => Math.random() - 0.5);
    }

    modal.style.display = "flex";
    grid.style.display = "none";
    nextQuestion();
}

function stopQuiz() {
    modal.style.display = "none";
    grid.style.display = "grid";
    loadData();

    const answered = answerList.length;       // å·²ä½œç­”é¡Œæ•¸
    const correct = examScore;                // ç­”å°é¡Œæ•¸

    if (quizMode === "exam" || quizMode === "practice") {
        if (wrongList.length) showReview();  // ç„¡è«–è€ƒè©¦æˆ–ç·´ç¿’ï¼Œåªè¦æœ‰éŒ¯é¡Œå°±é¡¯ç¤º

        if (quizMode === "exam") {
            alert(`è€ƒè©¦çµæŸï¼š${correct}/${quizPool.length} ï¼ˆå·²ç­”é¡Œï¼š${answered}ï¼‰`);
        } else if (quizMode === "practice") {
            alert(`ç·´ç¿’çµæŸï¼š${correct}/${answered}`);
        }
    }
}

function nextQuestion() {
if (questionIndex >= quizPool.length) {
    if (quizMode === "exam") {
        stopQuiz();
        return;
    } else {
        // ç·´ç¿’æ¨¡å¼ï¼šé‡æ–°æ´—ç‰Œã€å¾é ­ä¾†
        questionIndex = 0;
        quizPool.sort(() => Math.random() - 0.5);
    }
}
    answer = quizPool[questionIndex];
    questionIndex++;

question.innerHTML =
    quizType === "roma"
    ? `${quizMode === "exam" ? questionIndex + ". " : ""}${answer[0]}<br><span style="font-size:14px;color:#aaa;">ï¼ˆ${answer[2]||""}ï¼‰</span>`
    : `${quizMode === "exam" ? questionIndex + ". " : ""}${answer[1]}<br><span style="font-size:14px;color:#aaa;">ï¼ˆ${answer[2]||""}ï¼‰</span>`;

    const box = choices;
    box.innerHTML = "";

    const opts = [answer];
    while (opts.length < 4) {
        const r = pool[Math.floor(Math.random() * pool.length)];
        if (!opts.includes(r)) opts.push(r);
    }
    opts.sort(() => Math.random() - 0.5);

opts.forEach((o, i) => {
        const b = document.createElement("div");
        b.className = "choice";
        b.innerText = `${i + 1}. ` + (quizType === "roma" ? o[1] : o[0]);
        b.innerText = `${i + 1}. ` + (quizType === "roma" ? o[1] : o[0]);
        b.dataset.correct = (o === answer);
b.onclick = () => {
if (quizMode === "practice") {
    if (b.dataset.locked === "true") return;
    Array.from(box.children).forEach(c => c.dataset.locked = "true");

    const isCorrect = (o === answer);

    // è¨˜éŒ„ä½œç­”
    const record = {
        qNum: questionIndex,
        kana: answer[0],
        roma: answer[1],
        mean: answer[2] || "",
        chosenText: quizType === "roma" ? o[1] : o[0],
        chosenMean: o[2] || "",
        correctText: quizType === "roma" ? answer[1] : answer[0],
        correctMean: answer[2] || "",
        mode: quizType,
        correct: isCorrect
    };
    answerList.push(record);

    // ç­”å°ç´¯åŠ 
    if (isCorrect) examScore++;
    else wrongList.push(record); // â† æŠŠéŒ¯é¡ŒåŠ å…¥ wrongList

    // é¡¯ç¤ºé¡è‰²æç¤º
    if (isCorrect) {
        b.style.backgroundColor = "#81c784";
    } else {
        b.style.backgroundColor = "#ef5350";
        Array.from(box.children).forEach(c => {
            if (c.dataset.correct === "true") c.style.backgroundColor = "#81c784";
        });
    }

    setTimeout(nextQuestion, 600);
}

    // è€ƒè©¦æ¨¡å¼ç¶­æŒåŸæœ¬è¡Œç‚º
    if (quizMode === "exam") {
        const isCorrect = (o === answer);
        answerList.push({
            qNum: questionIndex,
            kana: answer[0],
            roma: answer[1],
            mean: answer[2] || "",
            chosenText: quizType === "roma" ? o[1] : o[0],
            chosenMean: o[2] || "",
            correctText: quizType === "roma" ? answer[1] : answer[0],
            correctMean: answer[2] || "",
            mode: quizType,
            correct: isCorrect
        });
        if (!isCorrect) wrongList.push(answerList.at(-1));
        if (isCorrect) examScore++;
        nextQuestion();
    }
};
        box.appendChild(b);
    });
}

function showReview() {
    const overlay = document.createElement("div");
    overlay.className = "reviewOverlay";
    const box = document.createElement("div");
    box.className = "reviewBox";
    box.innerHTML = "<h3>âŒ éŒ¯èª¤é¡Œç›®</h3>";

    let wrongCounter = 0;

    answerList.forEach((w) => {
        const questionDisplay = w.mode === "roma" ? `${w.kana}ï¼ˆ${w.mean}ï¼‰` : `${w.roma}ï¼ˆ${w.mean}ï¼‰`;
        const chosenDisplay = `${w.chosenText}ï¼ˆ${w.chosenMean}ï¼‰`;
        const answerDisplay = w.mode === "roma" ? `${w.roma}ï¼ˆ${w.mean}ï¼‰` : `${w.kana}ï¼ˆ${w.mean}ï¼‰`;

        // é¡Œè™Ÿéå¢
        wrongCounter++;

        box.innerHTML += `
        <div class="reviewItem">
            ç¬¬${wrongCounter}é¡Œ<br>
            ${questionDisplay}<br>
${w.correct
  ? `<span class="reviewCorrect">ä½ é¸ï¼š${chosenDisplay}</span>`
  : `
    <span class="reviewWrong">ä½ é¸ï¼š${chosenDisplay}</span><br>
    <span class="reviewCorrect">æ­£ç¢ºï¼š${answerDisplay}</span>
  `
}
        </div>`;
    });

    const btn = document.createElement("button");
    btn.innerText = "é—œé–‰";
    btn.onclick = () => overlay.remove();
    box.appendChild(btn);
    overlay.appendChild(box);
    document.body.appendChild(overlay);
}

loadData();
</script>

</body>
</html>
